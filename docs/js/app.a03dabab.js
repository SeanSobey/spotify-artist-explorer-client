(function(t){function e(e){for(var a,n,o=e[0],l=e[1],c=e[2],d=0,h=[];d<o.length;d++)n=o[d],i[n]&&h.push(i[n][0]),i[n]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);u&&u(e);while(h.length)h.shift()();return r.push.apply(r,c||[]),s()}function s(){for(var t,e=0;e<r.length;e++){for(var s=r[e],a=!0,o=1;o<s.length;o++){var l=s[o];0!==i[l]&&(a=!1)}a&&(r.splice(e--,1),t=n(n.s=s[0]))}return t}var a={},i={app:0},r=[];function n(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=a,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(s,a,function(e){return t[e]}.bind(null,a));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/spotify-artist-explorer-client/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var u=l;r.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("cd49")},"28c7":function(t,e,s){},"36dc":function(t,e,s){"use strict";var a=s("fc57"),i=s.n(a);i.a},6843:function(t,e,s){t.exports=s.p+"img/Spotify_logo_without_text_white.e9f47894.svg"},cd49:function(t,e,s){"use strict";s.r(e);var a=s("2b0e"),i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("Navigation"),s("router-view")],1)},r=[],n=s("9ab4"),o=s("60a3"),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-navbar",{staticClass:"mb-2",attrs:{type:"dark",variant:"primary"}},[a("b-navbar-brand",[a("img",{staticClass:"d-inline-block align-top",attrs:{src:s("6843"),width:"32",height:"32"}}),t._v("\n\t\tSpotify Artist Explorer\n\t")]),a("b-navbar-nav",{staticClass:"ml-auto"},[t._l(t.getRoutes(),function(e){return a("b-nav-item",{key:e.path,attrs:{active:t.isActive(e),to:e.path}},[t._v(t._s(e.name)+"\n\t\t")])}),a("b-nav-item",{attrs:{href:"https://github.com/SeanSobey/Spotify-Artist-Explorer"}},[a("font-awesome-icon",{attrs:{icon:["fab","github"],size:"lg"}})],1)],2)],1)},c=[],u=s("8c4f"),d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-container",{attrs:{fluid:""}},[a("b-row",{staticClass:"justify-content-center mt-5"},[a("b-button",{attrs:{variant:"primary"},on:{click:function(e){return t.loginOnClick()}}},[a("img",{staticClass:"mr-1 mb-1",attrs:{src:s("6843"),width:"16",height:"16"}}),t._v("Login to Spotify\n\t\t")])],1)],1)},h=[];const m={redirectURI:"http://localhost:8080/auth.html",clientId:"46ed660bda484776984c3c614bc14eca"},p="http://localhost:3000";let f=class extends o["b"]{constructor(){super(),this.authWindow=null,window.addEventListener("message",this.messageEventListener.bind(this),!1),this.spotify.setRedirectURI(m.redirectURI),this.spotify.setClientId(m.clientId)}loginOnClick(){const t=440,e=660,s=["user-follow-read"],a=["menubar=no","location=no","resizable=no","resizable=no","scrollbars=no","status=no","titlebar=no"],i=this.popupWindowCenter(this.spotify.createAuthorizeURL(s),"_blank",a,t,e);i&&(i.document.title="Spotify",this.authWindow=i)}popupWindowCenter(t,e,s,a,i){const r=window.screenLeft||window.screenX,n=window.screenTop||window.screenY,o=window.innerWidth||window.document.documentElement.clientWidth||document.body.clientWidth,l=window.innerHeight||window.document.documentElement.clientHeight||document.body.clientHeight,c=(o-a)/2+r,u=(l-i)/2+n,d=a,h=i;return window.open(t,e,[...s,`width=${d}`,`height=${h}`,`top=${u}`,`left=${c}`].join(", "))}messageEventListener(t){if(t.origin!==window.origin)return;if(!this.authWindow)return;this.authWindow.close(),this.authWindow=null;const e=t.data,s=new URL(p);s.searchParams.append("code",e),fetch(s.href,{method:"GET"}).then(t=>t.json()).then(t=>{const e={accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token,tokenType:t.token_type,scope:t.scope};this.spotify.setAccessToken(e.accessToken),this.spotify.setRefreshToken(e.refreshToken),this.$store.commit("authenticate",e),this.$router.push(R.home)}).catch(t=>{console.error("fetch failed",t)})}};f=n["a"]([Object(o["a"])({})],f);var b=f,g=b,y=s("2877"),w=Object(y["a"])(g,d,h,!1,null,null,null),v=w.exports,_=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div")},x=[];let k=class extends o["b"]{created(){this.$store.commit("unauthenticate"),this.$router.push(R.login)}};k=n["a"]([Object(o["a"])({})],k);var A,C=k,D=C,L=Object(y["a"])(D,_,x,!1,null,null,null),T=L.exports,j=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-container",{attrs:{fluid:""}},[s("b-nav",{attrs:{align:"right"}},[s("b-nav-form",[s("b-form-input",{staticClass:"mr-sm-2",attrs:{size:"sm",placeholder:"Artist"},model:{value:t.artistFilter,callback:function(e){t.artistFilter=e},expression:"artistFilter"}}),s("b-form-input",{staticClass:"mr-sm-2",attrs:{size:"sm",placeholder:"Year"},model:{value:t.yearFilter,callback:function(e){t.yearFilter=e},expression:"yearFilter"}})],1),t._l(t.displays,function(e){return s("b-nav-item",{key:e.displayType,attrs:{active:e.isActive},on:{click:function(s){return t.setDisplay(e.displayType)}}},[s("font-awesome-icon",{attrs:{icon:e.icon,size:"lg"}})],1)})],2),t.isLoading?s("b-row",{staticClass:"justify-content-center"},[s("span",{staticClass:"h1"},[s("font-awesome-icon",{staticClass:"spin mr-2",attrs:{icon:"spinner"}}),t._v("Loading Artists\n\t\t")],1)]):t._e(),t.isLoadingProgress?s("b-row",{staticClass:"justify-content-center"},[s("b-col",[s("b-progress",{staticClass:"my-2",attrs:{max:t.progressMax,height:"1.6em"}},[s("b-progress-bar",{attrs:{value:t.progress}},[s("span",{staticClass:"mx-auto"},[s("strong",[t._v(t._s(t.progress)+" / "+t._s(t.progressMax))])])])],1)],1)],1):t._e(),t.isViewActive("grid")?s("b-row",t._l(t.getGridItems(),function(e,a){return s("b-col",{key:a,staticClass:"col-sm-5 col-md-4 col-lg-3 col-xl-2",attrs:{"align-content":"center"}},[s("b-card",{staticClass:"my-2",attrs:{"img-src":e.image,"img-alt":e.name,"img-top":""}},[s("b-card-text",{staticClass:"text-center"},[s("b",{staticClass:"mb-0"},[t._v(t._s(t.formatReleaseDate(e.releaseDate)))]),s("p",{staticClass:"mb-0"},[t._v(t._s(e.artist))]),s("p",{staticClass:"mb-0"},[t._v(t._s(e.name))])])],1)],1)}),1):t._e(),t.isViewActive("list")?s("b-row",[s("b-table",{attrs:{striped:"",hover:"",items:t.getTableItems(),fields:t.getTableFields(),"sort-by":"artist","sort-direction":"asc"},scopedSlots:t._u([{key:"images",fn:function(t){return[s("b-img",{attrs:{thumbnail:"",fluid:"",src:t.item.image,alt:t.item.name}})]}}],null,!1,2084311091)})],1):t._e()],1)},O=[];async function F(t,e,s=5,a=2e3){try{return await t()}catch(i){if(0===s)throw i;if(!e(i))throw i;const r=a/s;return await $(r),F(t,e,s-1,a)}}async function $(t){return new Promise(e=>setTimeout(()=>e(),t))}(function(t){t["Grid"]="grid",t["List"]="list"})(A||(A={}));let E=class extends o["b"]{constructor(){super(...arguments),this.isLoading=!1,this.isLoadingProgress=!1,this.progress=0,this.progressMax=0,this.afterId=null,this.artistFilter="",this.yearFilter="",this.albums=[],this.displays=[{icon:"th",displayType:A.Grid,isActive:!1},{icon:"list",displayType:A.List,isActive:!0}]}created(){this.isLoading=!0,this.isLoadingProgress=!1,this.albums=[],(async()=>{this.progress=0;for await(const[t,e]of this.getAllFollowedArtists()){this.progressMax=t,this.isLoadingProgress=!0;for await(const[t,s]of this.batchGetArtistAlbums(e))this.progress++,this.albums.push(s)}})().catch(t=>{console.error("loading artists albums failed",t)}).finally(()=>{this.isLoading=!1,this.isLoadingProgress=!1,this.progress=0,this.progressMax=0})}setDisplay(t){this.displays.forEach(e=>e.isActive=e.displayType===t)}isViewActive(t){const e=this.displays.find(e=>e.displayType===t);if(!e)throw new Error(`Un-handled displayType: ${t}`);return e.isActive}getGridItems(){const t=this.albums.map(t=>({name:t.name,artist:t.artist,image:t.images[1],releaseDate:t.releaseDate}));return t.sort((t,e)=>{return t.artist.localeCompare(e.artist)}),t}getTableFields(){return[{key:"artist",label:"Artist",sortable:!0},{key:"name",label:"Name",sortable:!0},{key:"releaseDate",label:"Release Date",sortable:!0,formatter:t=>this.formatReleaseDate(t)},{key:"images",label:"Cover",sortable:!1}]}getTableItems(){return this.albums.filter(t=>{return""===this.artistFilter||t.artist.toLowerCase().includes(this.artistFilter.toLowerCase())}).filter(t=>{return""===this.yearFilter||t.releaseDate.getFullYear().toString().includes(this.yearFilter.toLowerCase())}).map(t=>({name:t.name,artist:t.artist,image:t.images[2],releaseDate:t.releaseDate}))}formatReleaseDate(t){return t.toLocaleDateString()}async*getAllFollowedArtists(){let t,e=!0;while(e){const s=await this.spotify.getFollowedArtists({type:"artist",limit:50,after:t});e=!!s.body.artists.next,t=s.body.artists.items[s.body.artists.items.length-1].id,yield[s.body.artists.total,s.body.artists.items]}}async*batchGetArtistAlbums(t){const e=t.map(t=>F(()=>this.spotify.getArtistAlbums(t.id,{limit:1,include_groups:"album"}),t=>429===t.statusCode).then(e=>({artist:t,albumData:e}))),s=await Promise.all(e);for(const{artist:a,albumData:i}of s){if(0===i.body.items.length)continue;const t=i.body.items.map(t=>this.createAlbum(t));t.sort((t,e)=>t.releaseDate.valueOf()-e.releaseDate.valueOf());const e=t[0];yield[a,e]}}createAlbum(t){const e=this.parseReleaseDate(t.release_date,t.release_date_precision);return{name:t.name,artist:t.artists[0].name,images:[t.images[0].url,t.images[1].url,t.images[2].url],releaseDate:e}}parseReleaseDate(t,e){switch(e){case"year":return new Date(t);case"month":return new Date(t);case"day":return new Date(t);default:throw new Error(`Un-hanlded releaseDatePrecision: ${e}`)}}};E=n["a"]([Object(o["a"])({})],E);var R,S=E,P=S,I=(s("36dc"),Object(y["a"])(P,j,O,!1,null,"1cf90606",null)),W=I.exports;a["default"].use(u["a"]),function(t){t["login"]="Login",t["logout"]="Logout",t["home"]="Home"}(R||(R={}));const M=[{path:"/home",name:R.home,component:W},{path:"/login",name:R.login,component:v},{path:"/logout",name:R.logout,component:T}];var z=class extends u["a"]{constructor(t){super({routes:M}),this.beforeEach((e,s,a)=>{if(e.name===R.login){if(t.state.authentication)return a({name:R.home})}else if(!t.state.authentication)return a({name:R.login});return a()})}};let G=class extends o["b"]{getRoutes(){const t=!!this.$store.state.authentication;return M.filter(e=>{return(e.name!==R.login||!t)&&((e.name!==R.login||!t)&&!(e.name===R.logout&&!t))})}isActive(t){return this.$router.currentRoute.name===t.name}};G=n["a"]([Object(o["a"])({})],G);var U=G,H=U,N=Object(y["a"])(H,l,c,!1,null,null,null),V=N.exports;let Y=class extends o["b"]{};Y=n["a"]([Object(o["a"])({components:{Navigation:V}})],Y);var J=Y,X=J,q=Object(y["a"])(X,i,r,!1,null,null,null),B=q.exports,K=s("2f62");a["default"].use(K["a"]);var Q=class extends K["a"].Store{constructor(){super({state:{authentication:null},mutations:{authenticate(t,e){t.authentication=e},unauthenticate(t){t.authentication=null}},actions:{}})}},Z=s("9f7b"),tt=s.n(Z),et=(s("28c7"),s("ecee")),st=s("c074"),at=s("f2d1"),it=s("ad3d"),rt=s("d9ca"),nt=s.n(rt),ot=s("a255"),lt=s.n(ot);a["default"].use(lt.a,new nt.a),a["default"].config.productionTip=!1,a["default"].use(tt.a),et["c"].add(st["b"],st["c"],st["a"]),et["c"].add(at["a"]),a["default"].component("font-awesome-icon",it["a"]),a["default"].component("font-awesome-layers",it["b"]),a["default"].component("font-awesome-layers-text",it["c"]);const ct=new Q,ut=new z(ct);new a["default"]({router:ut,store:ct,render:t=>t(B)}).$mount("#app")},fc57:function(t,e,s){}});
//# sourceMappingURL=app.a03dabab.js.map