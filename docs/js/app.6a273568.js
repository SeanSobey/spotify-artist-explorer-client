(function(t){function e(e){for(var a,n,o=e[0],l=e[1],c=e[2],h=0,d=[];h<o.length;h++)n=o[h],i[n]&&d.push(i[n][0]),i[n]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(t[a]=l[a]);u&&u(e);while(d.length)d.shift()();return r.push.apply(r,c||[]),s()}function s(){for(var t,e=0;e<r.length;e++){for(var s=r[e],a=!0,o=1;o<s.length;o++){var l=s[o];0!==i[l]&&(a=!1)}a&&(r.splice(e--,1),t=n(n.s=s[0]))}return t}var a={},i={app:0},r=[];function n(e){if(a[e])return a[e].exports;var s=a[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=a,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(s,a,function(e){return t[e]}.bind(null,a));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/spotify-artist-explorer-client/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var u=l;r.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("cd49")},"28c7":function(t,e,s){},"2b2d":function(t,e,s){},6843:function(t,e,s){t.exports=s.p+"img/Spotify_logo_without_text_white.e9f47894.svg"},a254:function(t,e,s){"use strict";var a=s("2b2d"),i=s.n(a);i.a},cd49:function(t,e,s){"use strict";s.r(e);var a=s("2b0e"),i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("Navigation"),s("router-view")],1)},r=[],n=s("9ab4"),o=s("60a3"),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-navbar",{staticClass:"mb-2",attrs:{type:"dark",variant:"primary"}},[a("b-navbar-brand",[a("img",{staticClass:"d-inline-block align-top",attrs:{src:s("6843"),width:"32",height:"32"}}),t._v("\n\t\tSpotify Artist Explorer\n\t")]),a("b-navbar-nav",{staticClass:"ml-auto"},[t._l(t.getRoutes(),function(e){return a("b-nav-item",{key:e.path,attrs:{active:t.isActive(e),to:e.path}},[t._v(t._s(e.name)+"\n\t\t")])}),a("b-nav-item",{attrs:{href:"https://github.com/SeanSobey/Spotify-Artist-Explorer"}},[a("font-awesome-icon",{attrs:{icon:["fab","github"],size:"lg"}})],1)],2)],1)},c=[],u=s("8c4f"),h=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("b-container",{attrs:{fluid:""}},[a("b-row",{staticClass:"justify-content-center mt-5"},[a("b-button",{attrs:{variant:"primary"},on:{click:function(e){return t.loginOnClick()}}},[a("img",{staticClass:"mr-1 mb-1",attrs:{src:s("6843"),width:"16",height:"16"}}),t._v("Login to Spotify\n\t\t")])],1)],1)},d=[];const p={redirectURI:"http://localhost:8080/auth.html",clientId:"46ed660bda484776984c3c614bc14eca"},f="http://localhost:3000";let m=class extends o["b"]{constructor(){super(),this.authWindow=null,window.addEventListener("message",this.messageEventListener.bind(this),!1),this.spotify.setRedirectURI(p.redirectURI),this.spotify.setClientId(p.clientId)}loginOnClick(){const t=440,e=660,s=screen.width/2-t/2,a=screen.height/2-e/2,i=["user-follow-read"];this.authWindow=window.open(this.spotify.createAuthorizeURL(i),"Spotify",`menubar=no,location=no,resizable=no,scrollbars=no,status=no,width=${t},height=${e},top=${a},left=${s}`)}messageEventListener(t){if(t.origin!==window.origin)return;if(!this.authWindow)return;this.authWindow.close(),this.authWindow=null;const e=t.data,s=new URL(f);s.searchParams.append("code",e),fetch(s.href,{method:"POST"}).then(t=>t.json()).then(t=>{const e={accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token,tokenType:t.token_type,scope:t.scope};this.spotify.setAccessToken(e.accessToken),this.spotify.setRefreshToken(e.refreshToken),this.$store.commit("authenticate",e),this.$router.push(S.home)}).catch(t=>{console.error("fetch failed",t)})}};m=n["a"]([Object(o["a"])({})],m);var b=m,g=b,y=s("2877"),v=Object(y["a"])(g,h,d,!1,null,null,null),w=v.exports,_=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div")},x=[];let A=class extends o["b"]{created(){this.$store.commit("unauthenticate"),this.$router.push(S.login)}};A=n["a"]([Object(o["a"])({})],A);var k,L=A,O=L,C=Object(y["a"])(O,_,x,!1,null,null,null),j=C.exports,T=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("b-container",{attrs:{fluid:""}},[s("b-nav",{attrs:{align:"right"}},[s("b-nav-form",[s("b-form-input",{staticClass:"mr-sm-2",attrs:{size:"sm",placeholder:"Artist"},model:{value:t.artistFilter,callback:function(e){t.artistFilter=e},expression:"artistFilter"}}),s("b-form-input",{staticClass:"mr-sm-2",attrs:{size:"sm",placeholder:"Year"},model:{value:t.yearFilter,callback:function(e){t.yearFilter=e},expression:"yearFilter"}})],1),t._l(t.displays,function(e){return s("b-nav-item",{key:e.displayType,attrs:{active:e.isActive},on:{click:function(s){return t.setDisplay(e.displayType)}}},[s("font-awesome-icon",{attrs:{icon:e.icon,size:"lg"}})],1)})],2),t.isLoading?s("b-row",{staticClass:"justify-content-center"},[s("span",{staticClass:"h1"},[s("font-awesome-icon",{staticClass:"spin mr-2",attrs:{icon:"spinner"}}),t._v("Loading Artists\n\t\t")],1)]):t._e(),t.isLoadingProgress?s("b-row",{staticClass:"justify-content-center"},[s("b-col",[s("b-progress",{staticClass:"my-2",attrs:{max:t.progressMax,height:"1.6em"}},[s("b-progress-bar",{attrs:{value:t.progress}},[s("span",{staticClass:"mx-auto"},[s("strong",[t._v(t._s(t.progress)+" / "+t._s(t.progressMax))])])])],1)],1)],1):t._e(),t.isViewActive("grid")?s("b-row",t._l(t.albums,function(e,a){return s("b-col",{key:a,staticClass:"col-sm-5 col-md-4 col-lg-3 col-xl-2",attrs:{"align-content":"center"}},[s("b-card",{staticClass:"my-2",attrs:{"img-src":e.images[1],"img-alt":e.name,"img-top":""}},[s("b-card-text",[t._v(t._s(e.artist)+" - "+t._s(t.formatReleaseDate(e.releaseDate))+" - "+t._s(e.name))])],1)],1)}),1):t._e(),t.isViewActive("list")?s("b-row",[s("b-table",{attrs:{striped:"",hover:"",items:t.getTableItems(),fields:t.getTableFields()},scopedSlots:t._u([{key:"images",fn:function(t){return[s("b-img",{attrs:{thumbnail:"",fluid:"",src:t.item.images[2],alt:t.item.name}})]}}],null,!1,4031086644)})],1):t._e()],1)},D=[];(function(t){t["Grid"]="grid",t["List"]="list"})(k||(k={}));const F=3;let $=class extends o["b"]{constructor(){super(...arguments),this.isLoading=!1,this.isLoadingProgress=!1,this.progress=0,this.progressMax=0,this.afterId=null,this.artistFilter="",this.yearFilter="",this.albums=[],this.displays=[{icon:"th",displayType:k.Grid,isActive:!1},{icon:"list",displayType:k.List,isActive:!0}]}created(){this.isLoading=!0,this.isLoadingProgress=!1,this.albums=[],(async()=>{this.progress=0;for await(const[t,e]of this.getAllFollowedArtists()){this.progressMax=t,this.isLoadingProgress=!0;for await(const[t,s]of this.batchGetArtistAlbums(e))this.progress++,this.albums.push(s),this.albums.sort((t,e)=>t.artist.localeCompare(e.artist))}})().catch(t=>{console.error("loading artists albums failed",t)}).finally(()=>{this.isLoading=!1,this.isLoadingProgress=!1,this.progress=0,this.progressMax=0})}setDisplay(t){this.displays.forEach(e=>e.isActive=e.displayType===t)}isViewActive(t){const e=this.displays.find(e=>e.displayType===t);if(!e)throw new Error(`Un-handled displayType: ${t}`);return e.isActive}getTableFields(){return[{key:"artist",label:"Artist",sortable:!0},{key:"name",label:"Name",sortable:!0},{key:"releaseDate",label:"Release Date",sortable:!0,formatter:t=>this.formatReleaseDate(t)},{key:"images",label:"Cover",sortable:!1}]}getTableItems(){return this.albums.filter(t=>{return""===this.artistFilter||t.artist.toLowerCase().includes(this.artistFilter.toLowerCase())}).filter(t=>{return""===this.yearFilter||t.releaseDate.getFullYear().toString().includes(this.yearFilter.toLowerCase())})}formatReleaseDate(t){return t.toLocaleDateString()}async*getAllFollowedArtists(){let t,e=!0;while(e){const s=this.spotify.getFollowedArtists({type:"artist",limit:50,after:t}),a=await s;e=!!a.body.artists.next,t=a.body.artists.items[a.body.artists.items.length-1].id,yield[a.body.artists.total,a.body.artists.items]}}async*batchGetArtistAlbums(t){const e=[...t];while(e.length>0){const t=e.splice(0,F),s=t.map(t=>this.spotify.getArtistAlbums(t.id,{limit:1,include_groups:"album"}).then(e=>({artist:t,albumData:e}))),a=await Promise.all(s);for(const{artist:e,albumData:i}of a){if(0===i.body.items.length)continue;const t=i.body.items.map(t=>this.createAlbum(t));t.sort((t,e)=>t.releaseDate.valueOf()-e.releaseDate.valueOf());const s=t[0];yield[e,s]}}}createAlbum(t){const e=this.parseReleaseDate(t.release_date,t.release_date_precision);return{name:t.name,artist:t.artists[0].name,images:[t.images[0].url,t.images[1].url,t.images[2].url],releaseDate:e}}parseReleaseDate(t,e){switch(e){case"year":return new Date(t);case"month":return new Date(t);case"day":return new Date(t);default:throw new Error(`Un-hanlded releaseDatePrecision: ${e}`)}}};$=n["a"]([Object(o["a"])({})],$);var S,R=$,P=R,E=(s("a254"),Object(y["a"])(P,T,D,!1,null,"f46853a4",null)),I=E.exports;a["default"].use(u["a"]),function(t){t["login"]="Login",t["logout"]="Logout",t["home"]="Home"}(S||(S={}));const M=[{path:"/home",name:S.home,component:I},{path:"/login",name:S.login,component:w},{path:"/logout",name:S.logout,component:j}];var U=class extends u["a"]{constructor(t){super({routes:M}),this.beforeEach((e,s,a)=>{if(e.name===S.login){if(t.state.authentication)return a({name:S.home})}else if(!t.state.authentication)return a({name:S.login});return a()})}};let z=class extends o["b"]{getRoutes(){const t=!!this.$store.state.authentication;return M.filter(e=>{return(e.name!==S.login||!t)&&((e.name!==S.login||!t)&&!(e.name===S.logout&&!t))})}isActive(t){return this.$router.currentRoute.name===t.name}};z=n["a"]([Object(o["a"])({})],z);var W=z,G=W,N=Object(y["a"])(G,l,c,!1,null,null,null),V=N.exports;let J=class extends o["b"]{};J=n["a"]([Object(o["a"])({components:{Navigation:V}})],J);var Y=J,H=Y,q=Object(y["a"])(H,i,r,!1,null,null,null),B=q.exports,K=s("2f62");a["default"].use(K["a"]);var Q=class extends K["a"].Store{constructor(){super({state:{authentication:null},mutations:{authenticate(t,e){t.authentication=e},unauthenticate(t){t.authentication=null}},actions:{}})}},X=s("9f7b"),Z=s.n(X),tt=(s("28c7"),s("ecee")),et=s("c074"),st=s("f2d1"),at=s("ad3d"),it=s("d9ca"),rt=s.n(it),nt=s("a255"),ot=s.n(nt);a["default"].use(ot.a,new rt.a),a["default"].config.productionTip=!1,a["default"].use(Z.a),tt["c"].add(et["b"],et["c"],et["a"]),tt["c"].add(st["a"]),a["default"].component("font-awesome-icon",at["a"]),a["default"].component("font-awesome-layers",at["b"]),a["default"].component("font-awesome-layers-text",at["c"]);const lt=new Q,ct=new U(lt);new a["default"]({router:ct,store:lt,render:t=>t(B)}).$mount("#app")}});
//# sourceMappingURL=app.6a273568.js.map